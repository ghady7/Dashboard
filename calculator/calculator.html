<!DOCTYPE html>
<html lang="en">
  <head>
    <link rel="stylesheet" href="calculator.css" />
  </head>
  <body onload="cursor()">
    <div class="calculator-body">
      <div class="screen">
        <div class="upper">
          <span id="calc"></span>
        </div>
        <div class="lower">
          <span id="indice"></span>
        </div>
      </div>
      <div class="buttons operations" onclick="display('%')">%</div>
      <div class="buttons operations" onclick="back()">&lt;</div>
      <div class="buttons operations" onclick="display('/')">/</div>
      <div class="buttons" id="c" onclick="clear1();cursor()">C</div>
      <div class="buttons" onclick="display('7')">7</div>
      <div class="buttons" onclick="display('8')">8</div>
      <div class="buttons" onclick="display('9')">9</div>
      <div class="buttons operations" onclick="display('*')">*</div>
      <div class="buttons" onclick="display('4')">4</div>
      <div class="buttons" onclick="display('5')">5</div>
      <div class="buttons" onclick="display('6')">6</div>
      <div class="buttons operations" onclick="display('-')">-</div>
      <div class="buttons" onclick="display('1')">1</div>
      <div class="buttons" onclick="display('2')">2</div>
      <div class="buttons" onclick="display('3')">3</div>
      <div class="buttons operations" onclick="display('+')">+</div>
      <div class="buttons" onclick="equal('-1')">+/-</div>
      <div class="buttons" onclick="display('0')">0</div>
      <div class="buttons" onclick="display('.')">.</div>
      <div class="buttons" id="equal" onclick="equal('')">=</div>
    </div>
  </body>
  <script>
    let result;
    let calc = document.getElementById("calc");
    let indice = document.getElementById("indice");
    let disp = "";

    function cursor() {
      if (calc.innerText == "") {
        calc.innerText = "|";
        calc.classList.add("animation");
      } else {
        calc.classList.remove("animation");
      }
    }

    function back() {
      let len = calc.innerText.length;
      disp = calc.innerText.substring(0, len - 1);
      display("");
    }
    function display(x) {
      if (calc.innerText.match(/[+\-/*%]/) && x.match(/[+\-/*%]/)) {
        if (!isNaN(calc.innerText.charAt(calc.innerText.length - 1))) {
          equal();
          disp = x;
          calc.innerText = disp;
        }

        return;
      }
      if (calc.classList.contains("animation")) {
        calc.classList.remove("animation");
      }

      disp += x;
      calc.innerText = disp;
    }
    function equal(y) {
      let text = calc.innerText;

      let indexOf;
      let op = calc.innerText.match(/[+\-*/%]/)?.[0];

      if (isNaN(text.charAt(text.length - 1))) return;
      switch (op) {
        case "+":
          indexOf = text.indexOf("+");

          if (isNaN(text.charAt(0))) {
            result = add(
              parseFloat(text.substring(indexOf + 1)),
              parseFloat(indice.innerHTML)
            );
          }

          result = add(
            parseFloat(text.substring(0, indexOf)),
            parseFloat(text.substring(indexOf + 1))
          );

          break;
        case "-":
          indexOf = text.indexOf("-");
          if (isNaN(text.charAt(0))) {
            result = substract(
              parseFloat(indice.innerHTML),
              parseFloat(text.substring(indexOf + 1))
            );
          } else
            result = substract(
              parseFloat(text.substring(0, indexOf)),
              parseFloat(text.substring(indexOf + 1))
            );
          break;
        case "*":
          indexOf = text.indexOf("*");
          if (isNaN(text.charAt(0))) {
            result = multiply(
              parseFloat(text.substring(indexOf + 1)),
              parseFloat(indice.innerHTML)
            );
          } else
            result = multiply(
              parseFloat(text.substring(0, indexOf)),
              parseFloat(text.substring(indexOf + 1))
            );
          break;
        case "/":
          indexOf = text.indexOf("/");
          if (isNaN(text.charAt(0))) {
            result = divide(
              parseFloat(indice.innerHTML),
              parseFloat(text.substring(indexOf + 1))
            );
          } else
            result = divide(
              parseFloat(text.substring(0, indexOf)),
              parseFloat(text.substring(indexOf + 1))
            );
          console.log(result);
          break;
        case "%":
          indexOf = text.indexOf("%");
          if (isNaN(text.charAt(0))) {
            result = modulo(
              parseFloat(indice.innerHTML),
              parseFloat(text.substring(indexOf + 1))
            );
          } else
            result = modulo(
              parseFloat(text.substring(0, indexOf)),
              parseFloat(text.substring(indexOf + 1))
            );
          break;
      }
      if (y == "-1") result = -result;
      if (result != undefined) {
        indice.innerText = result;
      } else {
        indice.innerText = "";
      }
      disp = "";
      calc.innerText = "";
    }

    function add(a, b) {
      return a + b;
    }
    function substract(a, b) {
      return a - b;
    }
    function divide(a, b) {
      if (b == 0) {
        alert("Can't divide by Zero");
        return;
      } else {
        return a / b;
      }
    }
    function modulo(a, b) {
      if (b == 0) {
        alert("Can't divide by Zero");
      } else {
        return a % b;
      }
    }
    function multiply(a, b) {
      return a * b;
    }
    function clear1() {
      result = 0;
      disp = "";
      calc.innerText = "";
      indice.innerText = "";
    }
  </script>
</html>
